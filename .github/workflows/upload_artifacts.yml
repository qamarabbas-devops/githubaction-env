name: Demo 05 - Pull Request

on:
    pull_request:
        branches:
            - main

jobs:
    build-test-branch:
        name: "Build and Test Of PR"
        runs-on: ubuntu-latest
        
        steps:
            - uses: actions/checkout@v4
              with:
                fetch-depth: 0  # Ensure all branches and files are fetched

            - name: Debug: Check project directory
              run: ls -R ${{ github.workspace }}

            - name: Setup .NET Core
              uses: actions/setup-dotnet@v3
              with:
                dotnet-version: '7.0'

            - name: Restore dependencies
              working-directory: mywebapp
              run: dotnet restore mywebapp.csproj
              
            - name: Build
              working-directory: mywebapp
              run: dotnet build mywebapp.csproj --configuration Release --no-restore
              
            - name: Test
              working-directory: mywebapp
              run: dotnet test mywebapp.csproj --no-restore --verbosity normal
              
            - name: Publish
              working-directory: mywebapp
              run: dotnet publish mywebapp.csproj -c Release -o mywebapp 
               
            - name: Upload a Build Artifact
              uses: actions/upload-artifact@v4
              with:
                name: mywebappbuildartifacts
                path: mywebapp/**
                if-no-files-found: error
                retention-days: 90
